___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "SafeOpt - Global Site Tag",
  "categories": [
    "TAG_MANAGEMENT"
  ],
  "brand": {
    "id": "brand_safeopt",
    "displayName": "SafeOpt",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "SafeOpt tag to be installed on all pages",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "site_id",
    "displayName": "Site or Widget ID",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "notSetText": "This is a required field, please contact help@addshoppers.com for questions",
    "help": "Site ID or the Widget ID provided by Addshoppers",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          24,
          24
        ]
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "load_css",
    "checkboxText": "Enable CSS Load",
    "simpleValueType": true,
    "displayName": "Load CSS",
    "help": "Should Addshoppers CSS be loaded?  This is used for onsite campaigns (default is False)"
  },
  {
    "type": "CHECKBOX",
    "name": "push_response",
    "checkboxText": "Enable Push Response",
    "simpleValueType": true,
    "displayName": "Push Response",
    "help": "This will allow for logging in console (default is False)"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const queryPermission = require('queryPermission');
const setInWindow = require('setInWindow');

log('data =', data);

var options = { 'loadCss': data.load_css, 'pushResponse': data.push_response };
setInWindow('AddShoppersWidgetOptions', options);

const injectScript = require('injectScript');
const url = "https://shop.pe/widget/widget_async.js#" + data.site_id;

const onSuccess = () => {
  log('Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Script load failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('Load failed due to permission');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://shop.pe/widget/widget_async.js*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "AddShoppersWidgetOptions"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 5/25/2023, 5:28:03 PM


